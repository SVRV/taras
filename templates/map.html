{% extends "layout.html" %}
{% set active_page = "map" %}
{% block body %}
<script src="https://maps.googleapis.com/maps/api/js"></script>
<script src="https://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/src/markerclusterer.js"></script>
<script>
    function initialize() {
        var mapCanvas = document.getElementById('map-canvas');
        var mapOptions = {
            center: new google.maps.LatLng(
                    48.23, 31.11
            ),
            zoom: 6,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        map = new google.maps.Map(mapCanvas, mapOptions)

        var markers = [];

        {% for entity, rows in data.iteritems() if entity == 'study' %}
            {% for item in rows %}
                 var marker = new google.maps.Marker({
                     position: new google.maps.LatLng({{ item.lat }}, {{ item.long }}),
                     map: map,
                 });

                 {% if entity == "work" %}
                    marker.setIcon("{{ url_for('static', filename='icons/map/work32.png') }}")
                 {% elif entity == "science" %}
                    marker.setIcon("{{ url_for('static', filename='icons/map/science32.png') }}")
                 {% elif entity == "study" %}
                     {% if item.master_count|int > 0 %}
                        marker.setIcon("{{ url_for('static', filename='icons/map/study/bm32.png') }}")
                     {% else %}
                        marker.setIcon("{{ url_for('static', filename='icons/map/study/b32.png') }}")
                     {% endif %}
                 {% endif %}

                google.maps.event.addListener(marker, 'click', function() {
                    new google.maps.InfoWindow({
                        content: '{{ item.description|safe|replace("\n", "\\n") }}'
                    }).open(map,this);
                });

                markers.push(marker);
            {% endfor %}
        {% endfor %}

        var markerCluster = new MarkerClusterer(map, markers);
    }

    google.maps.event.addDomListener(window, 'load', initialize);

    $(document).ready(function () {
        $('#toggle').click(function () {
            if ($('#sidebar').hasClass('open')) {
                $('#sidebar').removeClass('col-md-2');
                $('#sidebar').removeClass('open');
                $('#sidebar').addClass('hidden');
                $('#content').addClass('col-md-12');
                $('#content').removeClass('col-md-10');
                google.maps.event.trigger(map, "resize");
            }
            else {
                $('#sidebar').addClass('col-md-2');
                $('#sidebar').addClass('open');
                $('#sidebar').removeClass('hidden');
                $('#content').removeClass('col-md-12');
                $('#content').addClass('col-md-10');
                google.maps.event.trigger(map, "resize");
            }
        });
    });
</script>
<div class="row">
    <div id="content" class="col-md-10">
        <div id="map-canvas"></div>
        <a id="toggle">Toggle</a>
    </div>
    <div id="sidebar" class="col-md-2 open">
        <p>Marker Data</p>

        <p>Marker Data</p>

        <p>Marker Data</p>

    </div>
</div>

{% endblock %}